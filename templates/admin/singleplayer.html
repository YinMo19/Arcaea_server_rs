{% extends "admin/base.html" %}

{% block title %}Single Player Score{% endblock %}
{% block page_title %}单玩家成绩{% endblock %}
{% block page_subtitle %}对应 Python: /web/singleplayer{% endblock %}

{% block content %}
<article class="card section">
  <div class="section-head">
    <h3>查询</h3>
    <span class="muted">按 name 或 user_code 精确匹配</span>
  </div>

  <form class="toolbar" method="post" action="/web/singleplayer">
    <input class="input" name="name" placeholder="Arcaea Username" value="{{ query_name }}">
    <input class="input" name="user_code" placeholder="User Code" value="{{ query_user_code }}">
    <button class="btn btn-primary" type="submit">查询</button>
  </form>

  {% if message != "" %}
  <div class="actions">
    {% if message_kind == "error" %}
    <span class="tag tag-danger">{{ message }}</span>
    {% else %}
    <span class="tag tag-ok">{{ message }}</span>
    {% endif %}
  </div>
  {% endif %}
</article>

{% if show_user %}
<article class="card section">
  <div class="section-head">
    <h3>玩家</h3>
    <div class="top-actions">
      <a class="btn" href="/web/users/{{ user.user_id }}">打开详情</a>
    </div>
  </div>

  <div class="data-list">
    <div class="data-item">
      <div>
        <strong>{{ user.name }}</strong>
        <div class="muted">User ID: {{ user.user_id }} · Code: {{ user.user_code }}</div>
      </div>
      {% if user.banned %}
      <span class="tag tag-danger">封禁</span>
      {% else %}
      <span class="tag tag-ok">正常</span>
      {% endif %}
    </div>
    <div class="data-item">
      <div>
        <strong>PTT</strong>
        <div class="muted">rating_ptt / 100</div>
      </div>
      <span class="tag">{{ user.ptt }}</span>
    </div>
    <div class="data-item">
      <div><strong>Ticket</strong></div>
      <span class="tag">{{ user.ticket }}</span>
    </div>
  </div>
</article>

<article class="card section">
  <div class="section-head">
    <h3>Best Score 列表</h3>
    <span class="muted">共 {{ scores.len() }} 条</span>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Song</th>
          <th>Diff</th>
          <th>Score</th>
          <th>PURE</th>
          <th>FAR</th>
          <th>LOST</th>
          <th>Clear</th>
          <th>Best</th>
          <th>Rating</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        {% if scores.len() == 0 %}
        <tr>
          <td class="muted" colspan="11">无成绩</td>
        </tr>
        {% else %}
        {% for s in scores %}
        <tr>
          <td>{{ s.rank }}</td>
          <td>{{ s.song_id }}</td>
          <td>{{ s.difficulty }}</td>
          <td>{{ s.score }}</td>
          <td>{{ s.pure }}</td>
          <td>{{ s.far }}</td>
          <td>{{ s.lost }}</td>
          <td>{{ s.clear_type }}</td>
          <td>{{ s.best_clear_type }}</td>
          <td>{{ s.rating }}</td>
          <td>{{ s.time_played }}</td>
        </tr>
        {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
</article>
{% endif %}
{% endblock %}

